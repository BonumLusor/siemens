<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adicionar Novo Componente</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body class="container" style="overflow: auto !important;">
    <div class="header">
        <div class="logo-container">
            <h1 id="logo">
                Acqua<span>No</span><span>bi</span><span>lis</span>
            </h1>
        </div>
        <p>‚ûï Adicionar Novo Componente</p>
    </div>

    <div class="form-container">
        <form id="componentForm">
            <!-- Informa√ß√µes B√°sicas -->
            <div class="section">
                <h2 class="section-title">üìã Informa√ß√µes B√°sicas</h2>

                <div class="form-group">
                    <label for="category">Categoria <span class="required">*</span></label>
                    <select id="category" name="category" required>
                        <option value="">Selecione uma categoria</option>
                        <option value="fontes">Fontes de Alimenta√ß√£o</option>
                        <option value="disjuntores">Disjuntores</option>
                        <option value="contatores-potencia">Contatores de Pot√™ncia</option>
                        <option value="contatores-auxiliares">Contatores Auxiliares</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="grupo">Grupo/Fam√≠lia <span class="required">*</span></label>
                        <input type="text" id="grupo" name="grupo" required placeholder="Ex: SITOP PSU8600">
                    </div>
                    <div class="form-group">
                        <label for="nome">Nome do Produto <span class="required">*</span></label>
                        <input type="text" id="nome" name="nome" required placeholder="Ex: PSU8600 1 AC Unidade B√°sica">
                    </div>
                </div>

                <div class="form-group">
                    <label for="descricao_grupo">Descri√ß√£o do Grupo</label>
                    <textarea id="descricao_grupo" name="descricao_grupo"
                        placeholder="Descri√ß√£o detalhada da fam√≠lia de produtos..."></textarea>
                </div>
            </div>

            <!-- Varia√ß√µes do Produto -->
            <div class="section">
                <h2 class="section-title">üîß Varia√ß√µes do Produto</h2>
                <div id="variacoes-container">
                    <!-- Varia√ß√µes ser√£o adicionadas dinamicamente -->
                </div>
                <button type="button" class="btn add-variation-btn" onclick="addVariation()">
                    ‚ûï Adicionar Varia√ß√£o
                </button>
            </div>

            <!-- Campos espec√≠ficos por categoria -->

            <!-- Campos para Fontes -->
            <div id="fontes-fields" class="category-fields">
                <div class="section">
                    <h2 class="section-title">‚ö° Especifica√ß√µes de Fonte</h2>
                    <div class="help-text">Estes campos ser√£o aplicados a todas as varia√ß√µes. Valores espec√≠ficos podem
                        ser editados em cada varia√ß√£o.</div>
                </div>
            </div>

            <!-- Campos para Disjuntores -->
            <div id="disjuntores-fields" class="category-fields">
                <div class="section">
                    <h2 class="section-title">üîå Especifica√ß√µes de Disjuntor</h2>
                    <div class="help-text">Campos espec√≠ficos para disjuntores motores.</div>
                </div>
            </div>

            <!-- Campos para Contatores de Pot√™ncia -->
            <div id="contatores-potencia-fields" class="category-fields">
                <div class="section">
                    <h2 class="section-title">‚öôÔ∏è Especifica√ß√µes de Contator de Pot√™ncia</h2>
                    <div class="help-text">Campos espec√≠ficos para contatores de pot√™ncia.</div>
                </div>
            </div>

            <!-- Campos para Contatores Auxiliares -->
            <div id="contatores-auxiliares-fields" class="category-fields">
                <div class="section">
                    <h2 class="section-title">üîó Especifica√ß√µes de Contator Auxiliar</h2>
                    <div class="help-text">Campos espec√≠ficos para contatores auxiliares.</div>
                </div>
            </div>

            <!-- A√ß√µes do Formul√°rio -->
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="window.history.back()">
                    ‚Üê Voltar
                </button>
                <button type="button" class="btn btn-secondary" onclick="previewJSON()">
                    üëÅÔ∏è Visualizar JSON
                </button>
                <button type="submit" class="btn btn-success">
                    üíæ Salvar Componente
                </button>
            </div>
        </form>
    </div>
</body>

<!-- Modal para Preview do JSON -->
<div id="jsonModal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
    <div
        style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border-radius: 8px; max-width: 80%; max-height: 80%; overflow: auto; min-width: 50rem; min-height: 50rem;">
        <h3>Preview do JSON</h3>
        <pre id="jsonPreview"
            style="background: #f5f5f5; padding: 15px; border-radius: 4px; overflow: auto; max-height: 400px;"></pre>
        <div style="margin-top: 15px; text-align: right;">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">Fechar</button>
        </div>
    </div>
</div>

<script>
    let variationCount = 0;

    // Configura√ß√£o de campos por categoria
    const categoryConfigs = {
        'fontes': {
            fields: ['tensao_entrada', 'corrente_saida', 'dimensoes'],
            templates: {
                tensao_entrada: 'text',
                corrente_saida: 'text',
                dimensoes: 'text'
            }
        },
        'disjuntores': {
            fields: ['faixa_ajuste_A'],
            templates: {
                faixa_ajuste_A: 'text'
            }
        },
        'contatores-potencia': {
            fields: ['corrente_ac3_A', 'corrente_ac1_A', 'dimensoes_mm', 'potencia_motor_cv_kw'],
            templates: {
                corrente_ac3_A: 'number',
                corrente_ac1_A: 'number',
                dimensoes_mm: 'text',
                potencia_motor_cv_kw: 'text'
            }
        },
        'contatores-auxiliares': {
            fields: ['tensao_comando', 'tipo_conexao'],
            templates: {
                tensao_comando: 'text',
                tipo_conexao: 'text'
            }
        }
    };

    // Event listener para mudan√ßa de categoria
    document.getElementById('category').addEventListener('change', function () {
        // Ocultar todos os campos espec√≠ficos
        document.querySelectorAll('.category-fields').forEach(field => {
            field.classList.remove('active');
        });

        // Mostrar campos da categoria selecionada
        const selectedCategory = this.value;
        if (selectedCategory) {
            const categoryField = document.getElementById(selectedCategory + '-fields');
            if (categoryField) {
                categoryField.classList.add('active');
            }
        }

        // Limpar varia√ß√µes existentes ao mudar categoria
        document.getElementById('variacoes-container').innerHTML = '';
        variationCount = 0;

        // Adicionar primeira varia√ß√£o automaticamente
        if (selectedCategory) {
            addVariation();
        }
    });

    function addVariation() {
        const category = document.getElementById('category').value;
        if (!category) {
            showNotification('Selecione uma categoria primeiro!', 'error');
            return;
        }

        const config = categoryConfigs[category];
        const container = document.getElementById('variacoes-container');
        const variationId = ++variationCount;

        let fieldsHTML = '';

        // Campos b√°sicos para todas as varia√ß√µes
        fieldsHTML += `
                <div class="form-row">
                    <div class="form-group">
                        <label>C√≥digo <span class="required">*</span></label>
                        <input type="text" name="variacao_${variationId}_codigo" required 
                               placeholder="Ex: 6EP3336-8MB00-2CY0">
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o <span class="required">*</span></label>
                        <input type="text" name="variacao_${variationId}_descricao" required 
                               placeholder="Ex: 24 V DC/20 A/4 x 5 A">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group half">
                        <label>Pre√ßo (R$) <span class="required">*</span></label>
                        <input type="number" name="variacao_${variationId}_preco" step="0.01" required 1
                               placeholder="0.00">
                    </div>
                </div>
            `;

        // Campos espec√≠ficos da categoria
        if (config) {
            config.fields.forEach(field => {
                const inputType = config.templates[field] || 'text';
                const fieldName = field.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());

                fieldsHTML += `
                        <div class="form-group">
                            <label>${fieldName}</label>
                            <input type="${inputType}" name="variacao_${variationId}_${field}" 
                                   placeholder="${getPlaceholder(field)}">
                        </div>
                    `;
            });
        }

        const variationHTML = `
                <div class="variation-item" id="variation-${variationId}">
                    <button type="button" class="remove-variation" onclick="removeVariation(${variationId})">√ó</button>
                    <h4 style="margin-bottom: 15px; color: var(--primary);">Varia√ß√£o ${variationId}</h4>
                    ${fieldsHTML}
                </div>
            `;

        container.insertAdjacentHTML('beforeend', variationHTML);
    }

    function removeVariation(id) {
        const element = document.getElementById(`variation-${id}`);
        if (element) {
            element.remove();
        }
    }

    function getPlaceholder(field) {
        const placeholders = {
            'tensao_entrada': '100 ... 240 V AC',
            'corrente_saida': '20 A',
            'dimensoes': '125 x 125 x 150',
            'faixa_ajuste_A': '4,5-6,3',
            'corrente_ac3_A': '18',
            'corrente_ac1_A': '32',
            'dimensoes_mm': '45 x 74.4 x 81.8',
            'potencia_motor_cv_kw': '5/3,7',
            'tensao_comando': '220 V/50-60 Hz',
            'tipo_conexao': 'Mola'
        };
        return placeholders[field] || '';
    }

    function previewJSON() {
        const formData = new FormData(document.getElementById('componentForm'));
        const componentData = buildComponentObject(formData);

        document.getElementById('jsonPreview').textContent = JSON.stringify(componentData, null, 2);
        document.getElementById('jsonModal').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('jsonModal').style.display = 'none';
    }

    function buildComponentObject(formData) {
        const category = formData.get('category');
        const grupo = formData.get('grupo');
        const nome = formData.get('nome');
        const descricao_grupo = formData.get('descricao_grupo');

        // Coletar varia√ß√µes
        const variacoes = [];
        const variationElements = document.querySelectorAll('.variation-item');

        variationElements.forEach((element, index) => {
            const variationId = element.id.split('-')[1];
            const variacao = {
                codigo: formData.get(`variacao_${variationId}_codigo`),
                descricao: formData.get(`variacao_${variationId}_descricao`),
                preco: parseFloat(formData.get(`variacao_${variationId}_preco`))
            };

            // Adicionar campos espec√≠ficos da categoria
            const config = categoryConfigs[category];
            if (config) {
                config.fields.forEach(field => {
                    const value = formData.get(`variacao_${variationId}_${field}`);
                    if (value) {
                        if (field.includes('corrente') && field.includes('_A')) {
                            variacao[field] = parseFloat(value);
                        } else {
                            variacao[field] = value;
                        }
                    }
                });
            }

            variacoes.push(variacao);
        });

        return {
            grupo: grupo,
            descricao_grupo: descricao_grupo,
            produtos: [{
                nome: nome,
                variacoes: variacoes
            }]
        };
    }

    function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
            notification.remove();
        }, 3000);
    }

    // Event listener para submiss√£o do formul√°rio
    document.getElementById('componentForm').addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = new FormData(this);
        const componentData = buildComponentObject(formData);

        // Simular salvamento (aqui voc√™ integraria com sua API)
        console.log('Dados do componente:', componentData);

        showNotification('Componente salvo com sucesso!', 'success');

        // Opcional: resetar formul√°rio
        setTimeout(() => {
            this.reset();
            document.getElementById('variacoes-container').innerHTML = '';
            variationCount = 0;
            document.querySelectorAll('.category-fields').forEach(field => {
                field.classList.remove('active');
            });
        }, 1500);
    });

    // Adicionar primeira varia√ß√£o quando carregar a p√°gina
    document.addEventListener('DOMContentLoaded', function () {
        // Opcional: pode adicionar uma varia√ß√£o inicial aqui se desejar
    });
</script>

</html>